<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv='cache-control' content='no-cache'> 
	<meta http-equiv='expires' content='0'> 
	<meta http-equiv='pragma' content='no-cache'>
	<meta name="description" content="A feature to show shopping list">
	<meta name="title" content="Belanja Bulanext">
	<title>Belanja Bulanext | Bona Muvid's Page</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="custom.css">
	<script>
		async function sha256(message) {
		    const msgBuffer = new TextEncoder().encode(message);
		    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
		    const hashArray = Array.from(new Uint8Array(hashBuffer));
		    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
		}
		
		const storedHash = "b88ca91d70377891dec3803a5206b0e19cedd0934718ddcf8c2b4a53307cc431";
		
		async function checkPassword() {
		    let input = sessionStorage.getItem("pagePassword");
		
		    if (!input) input = prompt("Enter password:");
		
		    if (input) {
		        const hashed = await sha256(input);
		        if (hashed === storedHash) {
		            sessionStorage.setItem("pagePassword", input);
		            return;
		        }
		    }
		
		    document.body.innerHTML = "<h1>Access Denied</h1>";
		    throw new Error("Denied");
		}
		
		await checkPassword();
	</script>
	<script type="module">
		import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
		import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

		const firebaseConfig = {
			apiKey: "AIzaSyDwMCTIK38vlLLAHByz0MRWz4FgeXhMh6g",
			authDomain: "github-belanja-bulanext.firebaseapp.com",
			databaseURL: "https://github-belanja-bulanext-default-rtdb.asia-southeast1.firebasedatabase.app/",
			projectId: "github-belanja-bulanext",
			storageBucket: "github-belanja-bulanext.firebasestorage.app",
			messagingSenderId: "718219974978",
			appId: "1:718219974978:web:30505728a4806d857d10db"
		};

		const app = initializeApp(firebaseConfig);
		const db = getDatabase(app);

		let itemsRef = ref(db, "shoppingList");

		onValue(itemsRef, (snapshot) => {
			let ul = document.getElementById("keranjang");
			ul.innerHTML = "";

			snapshot.forEach((child) => {
				let li = document.createElement("li");
				li.textContent = child.val().name;
				ul.appendChild(li);
			});
		});

		window.addItem = function () {
			let input = document.getElementById("daftar");
			let text = input.value.trim();
			if (text === "") return;

			push(itemsRef, { name: text });
			input.value = "";
		};

		window.onload = function () {
			let input = document.getElementById("daftar");
			input.addEventListener("keypress", function(event) {
				if (event.key === "Enter") {
					event.preventDefault();
					addItem();
				}
			});
		};
	</script>
</head>
<body>
	<div class="mainwrapper">
		<h1>Belanja Bulanext</h1>
		<hr/>
		<div class="input-group mb-3">
			<input class="form-control" type="text" id="daftar" placeholder="Nama Barang" onclick="this.select()" style="margin: 5px;">
			<div class="input-group-append">
				<button class="btn btn-outline-secondary" id="tambahkan" onclick="addItem()" style="margin: 5px;">Tambahkan</button>
			</div>
		</div>
		<div>
			<ul id="keranjang"></ul>
		</div>
	</div>
</body>
</html>
